-- Khai báo các dịch vụ
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local localPlayer = Players.LocalPlayer
local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Dừng chuyển động của player và đặt trọng lực về 0
humanoid.WalkSpeed = 0
humanoid.JumpPower = 0
game.Workspace.Gravity = 0

-- UI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game.CoreGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 150)
frame.Position = UDim2.new(0.5, -125, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Parent = screenGui

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 30)
titleLabel.Text = "Player Tracker"
titleLabel.TextColor3 = Color3.new(1, 1, 1)
titleLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
titleLabel.Parent = frame

local nextPlayerButton = Instance.new("TextButton")
nextPlayerButton.Size = UDim2.new(1, 0, 0, 40)
nextPlayerButton.Position = UDim2.new(0, 0, 0, 40)
nextPlayerButton.Text = "Next Player"
nextPlayerButton.TextColor3 = Color3.new(1, 1, 1)
nextPlayerButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
nextPlayerButton.Parent = frame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(1, 0, 0, 40)
closeButton.Position = UDim2.new(0, 0, 0, 90)
closeButton.Text = "Close"
closeButton.TextColor3 = Color3.new(1, 1, 1)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 69, 58)
closeButton.Parent = frame

-- Tìm player gần nhất
local function getNearestPlayer()
    local closestPlayer = nil
    local closestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - humanoidRootPart.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end
    return closestPlayer
end

-- Tween đến vị trí
local function tweenToPosition(part, position)
    local tweenInfo = TweenInfo.new((part.Position - position).Magnitude / 100, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut)
    local tweenGoal = {Position = position}
    local tween = TweenService:Create(part, tweenInfo, tweenGoal)
    tween:Play()
end

-- Cập nhật vị trí liên tục đến player gần nhất
local currentTarget = nil
RunService.Heartbeat:Connect(function()
    if currentTarget and currentTarget.Character and currentTarget.Character:FindFirstChild("HumanoidRootPart") then
        local targetRoot = currentTarget.Character.HumanoidRootPart
        tweenToPosition(humanoidRootPart, targetRoot.Position + Vector3.new(0, 3, 0))
    end
end)

-- Làm nhân vật tàng hình
local function makeInvisible()
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") then
            part.Transparency = 1
        end
    end
end

-- Bật Anti-kick
local function antiKick()
    humanoid.HealthChanged:Connect(function()
        if humanoid.Health < 10 then
            humanoid.Health = 100
        end
    end)
end

-- Bật Noclip
local function enableNoClip()
    RunService.Stepped:Connect(function()
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
end

-- Chạy xa khi máu <= 5000
local function runFarAway()
    if humanoid.Health <= 5000 then
        local safePosition = humanoidRootPart.Position + Vector3.new(math.random(-500, 500), 0, math.random(-500, 500))
        tweenToPosition(humanoidRootPart, safePosition)
    end
end

-- Kiểm tra máu liên tục
RunService.Heartbeat:Connect(runFarAway)

-- Khi ấn nút "Next Player"
nextPlayerButton.MouseButton1Click:Connect(function()
    currentTarget = getNearestPlayer()
    if currentTarget then
        makeInvisible()
        antiKick()
        enableNoClip()
    end
end)

-- Khi ấn nút "Close"
closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
    currentTarget = nil
    humanoid.WalkSpeed = 16 -- Khôi phục di chuyển
    humanoid.JumpPower = 50
    game.Workspace.Gravity = 196.2 -- Khôi phục trọng lực mặc định
end)

print("✅ Script chạy hoàn hảo!")
